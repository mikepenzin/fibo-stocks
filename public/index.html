<!doctype html>
<html lang="en" data-bs-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stocks Analyzer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
</head>
<body>
<div class="container">
  <header class="mb-3">
    <h1 class="h4 mb-1"><i class="bi bi-graph-up-arrow"></i> Stocks Analyzer</h1>
    <div class="text-secondary small">Express API + Bootstrap • Data: Yahoo Finance • Timeframe: <span id="headerTimeframe">1D</span> • MA: <span id="headerMABasis">20/50</span></div>
  </header>

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <form id="form" class="row g-2 align-items-center">
        <div class="col-auto"><label for="ticker" class="col-form-label">Ticker</label></div>
        <div class="col-auto position-relative">
          <input id="ticker" class="form-control ticker-input" placeholder="e.g. NVDA, AAPL" required autocomplete="off" list="tickerList">
          <!-- <div id="suggestBox" class="position-absolute bg-body border rounded shadow-sm w-100 mt-1 d-none" style="z-index:1000; max-height: 260px; overflow:auto;"></div> -->
          <datalist id="tickerList"></datalist>
        </div>
        <div class="col-auto form-check ms-2">
          <input class="form-check-input" type="checkbox" id="showChart" checked>
          <label class="form-check-label" for="showChart">Show chart</label>
        </div>
        <div class="col-auto">
          <select id="range" class="form-select form-select-sm" style="min-width:110px">
            <option value="1d" selected>1 Day</option>
            <option value="1h">1 Hour</option>
            <option value="15m">15 Minutes</option>
            <option value="5m">5 Minutes</option>
            <option value="1w">1 Week</option>
          </select>
        </div>
        <div class="col-auto">
          <select id="maBasis" class="form-select form-select-sm" title="MA pair" style="min-width:110px">
            <option value="20-50" selected>MA20/50</option>
            <option value="50-150">MA50/150</option>
          </select>
        </div>
        <div class="col-auto"><button id="go" class="btn btn-primary" type="submit">Analyze</button></div>
        <div class="col-auto"><span id="spin" class="spinner-border spinner-border-sm text-primary d-none"></span></div>
      </form>
    </div>
  </div>

  <div id="alert" class="alert alert-danger d-none" role="alert"></div>

  <div class="row g-3 mb-3">
    <div class="col-12 mb-2 d-flex justify-content-end gap-2 d-none" id="actionButtons">
      <!-- <button id="backtestBtn" class="btn btn-outline-warning btn-sm">Backtest Fib</button> -->
      <button id="downloadImg" class="btn btn-outline-primary btn-sm"><i class="bi bi-download"></i> Download as Image</button>
      <button id="copyImg" class="btn btn-outline-secondary btn-sm"><i class="bi bi-clipboard"></i> Copy Result to Clipboard</button>
      <button id="shareLink" class="btn btn-outline-dark btn-sm"><i class="bi bi-share"></i> Share Analysis</button>
    </div>
    <div class="col-lg-6">
      <div id="panel" class="card shadow-sm d-none h-100">
        <div class="card-body">
          <div class="d-flex flex-wrap align-items-center justify-content-between">
            <div class="h5 mb-0" id="title"></div>
            <div class="d-flex align-items-center gap-2">
              <span id="tfBadge" class="badge text-bg-secondary">1D</span>
              <span id="expBadge" class="badge d-none"></span>
            </div>
          </div>
          <hr class="my-3">
          <div class="kv small">
            <div class="k" title="Last traded price">Price</div><div class="v" id="price"></div>
            <div class="k" title="Overall directional structure based on selected MA pair">Trend</div><div class="v" id="trend"></div>
            <div class="k" title="Relative Strength Index (14)">RSI(14)</div><div class="v" id="rsi"></div>
            <div class="k" title="Commodity Channel Index (14)">CCI(14)</div><div class="v" id="cci"></div>
            <div class="k" title="Average True Range (14)">ATR(14)</div><div class="v" id="atr"></div>
            <div class="k" title="ATR as % of price">ATR %</div><div class="v" id="atrpct"></div>
            <div class="k" title="Volume vs 20 period moving average">Vol Δ vs 20d</div><div class="v" id="vold"></div>
            <div class="k" title="Next earnings date distance">Earnings</div><div class="v" id="earn"></div>
          </div>
          <div id="insight" class="insight-box small mt-2 d-none"></div>
          <hr>
          <div class="mb-1 fw-semibold">Trade plan</div>
          <div class="kv">
            <div class="k" title="Directional bias + confidence stars">Bias</div><div class="v" id="bias"></div>
            <div class="k" title="Suggested entry level">Entry</div><div class="v mono" id="entry"></div>
            <div class="k" title="Protective stop">Stop Loss</div><div class="v mono" id="sl"></div>
            <div class="k" title="First profit target">TP1</div><div class="v mono" id="tp1"></div>
            <div class="k" title="Second profit target / stretch">TP2</div><div class="v mono" id="tp2"></div>
          </div>
          <hr>
          <div class="mb-1 fw-semibold">Support & Resistance levels</div>
          <div class="kv small">
            <div class="k" title="Key resistance level above current price">Resistance</div><div class="v mono" id="keyResistance"></div>
            <div class="k" title="Key support level below current price">Support</div><div class="v mono" id="keySupport"></div>
          </div>
          <hr>
          <div class="mb-1 fw-semibold">Fibonacci levels (auto swing)</div>
          <div class="fib-grid small mono" id="fibs"></div>
          <div id="btSection" class="mt-3 d-none">
            <div class="fw-semibold mb-1">Backtest (recent swings)</div>
            <div class="small" id="btStats"></div>
            <div class="table-responsive small mt-2">
              <table class="table table-sm table-bordered align-middle mb-0">
                <thead class="table-light"><tr><th>Date</th><th>Entry(50%)</th><th>Target(38.2%)</th><th>Stop(61.8%)</th><th>Outcome</th></tr></thead>
                <tbody id="btRows"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div id="chartCard" class="card shadow-sm d-none h-100">
        <div class="card-body">
          <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
            <div class="fw-semibold">Chart (OHLC + Fib)</div>
            <div class="d-flex align-items-center gap-2">
              <select id="flowMetric" class="form-select form-select-sm" title="Flow metric">
                <option value="OBV" selected>OBV</option>
                <option value="MFI">MFI</option>
                <option value="CMF">CMF</option>
              </select>
              <!-- <button id="savePng" class="btn btn-outline-secondary btn-sm">Save PNG</button> -->
            </div>
          </div>
          <canvas id="chart" width="980" height="420" class="mt-2 chart-canvas"></canvas>
          <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="fw-semibold small" id="flowTitle">Flow: OBV + Price</div>
          </div>
          <canvas id="flowChart" width="980" height="200" class="mt-2 chart-canvas"></canvas>
          <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="fw-semibold small">Support/Resistance Levels</div>
          </div>
          <canvas id="srChart" width="980" height="180" class="mt-2 chart-canvas"></canvas>
          <div class="small text-secondary mt-2">Lightweight canvas rendering (price + selectable flow metric + S/R levels).</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
    <div id="mainToast" class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toastMsg">Copied to clipboard!</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <footer class="mt-4 text-secondary small">
     Made with ❤️ by <a href="https://github.com/mikepenzin/fibo-stocks">Mike Penzin</a>
  </footer>

  <!-- Fullscreen Chart Modals (separate) -->
  <div class="modal fade" id="priceModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-md-down modal-xl" style="max-width:95vw;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Price Chart</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="small text-secondary mb-2" id="priceModalMeta"></div>
          <canvas id="priceModalCanvas" width="1400" height="640" class="w-100 border rounded"></canvas>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary btn-sm" id="priceModalSave">Save PNG</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="flowModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-md-down modal-xl" style="max-width:95vw;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Flow Chart</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <canvas id="flowModalCanvas" width="1400" height="320" class="w-100 border rounded"></canvas>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary btn-sm" id="flowModalSave">Save PNG</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="srModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-md-down modal-xl" style="max-width:95vw;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Support / Resistance</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <canvas id="srModalCanvas" width="1400" height="320" class="w-100 border rounded"></canvas>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary btn-sm" id="srModalSave">Save PNG</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript Files -->
<script src="js/utils.js"></script>
<script src="js/ticker-search.js"></script>
<script src="js/technical-analysis.js"></script>
<script src="js/chart-rendering.js"></script>
<script src="js/modals.js"></script>
<script src="js/analysis.js"></script>
<script src="js/export.js"></script>
<script src="js/routing.js"></script>
<script src="js/app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</body>
</html>
